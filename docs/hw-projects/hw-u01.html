<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Homework U01: NIJ Recidivism Challenge</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="hw-u01_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw-u01_files/libs/quarto-html/quarto.js"></script>
<script src="hw-u01_files/libs/quarto-html/popper.min.js"></script>
<script src="hw-u01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw-u01_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw-u01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw-u01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw-u01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw-u01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw-u01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-data" id="toc-the-data" class="nav-link active" data-scroll-target="#the-data">The data</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise 5</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6">Exercise 6</a></li>
  <li><a href="#exercise-7" id="toc-exercise-7" class="nav-link" data-scroll-target="#exercise-7">Exercise 7</a></li>
  <li><a href="#exercise-8" id="toc-exercise-8" class="nav-link" data-scroll-target="#exercise-8">Exercise 8</a></li>
  <li><a href="#exercise-9" id="toc-exercise-9" class="nav-link" data-scroll-target="#exercise-9">Exercise 9</a></li>
  <li><a href="#exercise-10" id="toc-exercise-10" class="nav-link" data-scroll-target="#exercise-10">Exercise 10</a></li>
  <li><a href="#exercise-11" id="toc-exercise-11" class="nav-link" data-scroll-target="#exercise-11">Exercise 11</a></li>
  <li><a href="#exercise-12" id="toc-exercise-12" class="nav-link" data-scroll-target="#exercise-12">Exercise 12</a></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework U01: NIJ Recidivism Challenge</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><img src="../imgs/Angola-prison1.jpg" class="img-fluid"></p>
<div class="callout-caution callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>Our learning objectives for this homework are:</p>
<ul>
<li>Apply the fundamental machine learning workflow from start to finish</li>
<li>Use data munging skills to conduct feature engineering for machine learning</li>
<li>Gain hands-on experience with building and applying logistic regression models</li>
<li>Use model visualizations to gain insight into the dynamics of criminality and rehabilitation</li>
</ul>
</div>
</div>
<p>In this homework, we’ll take on the National Institute of Justice’s (NIJ) <a href="https://nij.ojp.gov/funding/recidivism-forecasting-challenge">Recidivism Forecasting Challenge</a> that challenged data scientists to forecast the probability that parolees would recidivate within one, two, or three years.</p>
<p>Here’s how the NIJ described it:</p>
<blockquote class="blockquote">
<p>The Challenge uses data on roughly 26,000 individuals from the State of Georgia released from Georgia prisons on discretionary parole to the custody of the Georgia Department of Community Supervision (GDCS) for the purpose of post-incarceration supervision between January 1, 2013 and December 31, 2015.</p>
</blockquote>
<blockquote class="blockquote">
<p>The Challenge aims to improve the ability to forecast recidivism using person- and place-based variables with the goal of improving outcomes for those serving a community supervision sentence. We hope through the Challenge to encourage discussion on the topics of reentry, bias/fairness, measurement, and algorithm advancement.</p>
</blockquote>
<p>With one of the highest incarceration rates in the world, U.S. prisons house a vast population of inmates, many of whom are serving time for non-violent offenses. This system, characterized by overcrowding and limited access to effective rehabilitation programs, tends to create a cycle of recidivism rather than offering a path to societal reintegration. The lack of rehabilitative focus not only challenges the prospects of successful reentry for former inmates but also raises significant questions about the broader goals and effectiveness of the penal system in the United States. This systemic issue underscores the need for a paradigm shift towards more rehabilitative and restorative approaches in addressing crime and punishment.</p>
<p>The parole system in Georgia is designed as a means of reintegrating offenders back into society under supervised release, after they have served a portion of their prison sentence. The decision to grant parole is based on several factors, including the nature of the crime, the inmate’s behavior while incarcerated, their rehabilitation efforts, and the potential risk to public safety.</p>
<p>Once granted parole, the individual is released into the community but must comply with specific conditions set by the parole board. These conditions often include regular meetings with a parole officer, drug testing, employment requirements, and sometimes restrictions on travel and association. Violating these conditions can result in the revocation of parole and a return to prison.</p>
<p><strong>Here, we will apply logistic regression to this dataset to predict recidivism among people formerly incarcerated in the Georgia prison system.</strong></p>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>The data for this homework comes from the National Institute for Justice Georgia’s “Recidivism Forecasting Challenge.”</p>
<blockquote class="blockquote">
<p>The Challenge uses data on roughly 26,000 individuals from the State of Georgia released from Georgia prisons on discretionary parole to the custody of the Georgia Department of Community Supervision (GDCS) for the purpose of post-incarceration supervision between January 1, 2013 and December 31, 2015.</p>
</blockquote>
<p>Before you begin, please take note of the data’s terms of use:</p>
<blockquote class="blockquote">
<p><strong>Privacy and Confidentiality of Data</strong></p>
<p>Any intentional identification of a individuals or unauthorized disclosure of his or her confidential information violates the promise of confidentiality given to the providers of the information. Therefore, users of data agree:</p>
<ul>
<li>To use these datasets solely for research or statistical purposes and not for investigation of specific individuals</li>
<li>To make no use of the identity of any individual discovered inadvertently, and to advise NIJ of any such discovery (NIJRecidivismChallenge@usdoj.gov)</li>
</ul>
</blockquote>
<p>I’ve downloaded the data and performed some initial data munging to get you started (copy and paste this to load the data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>to_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(y), <span class="fu">max</span>(y<span class="sc">+</span><span class="dv">1</span>, <span class="at">na.rm=</span>T), y)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>nij <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/NIJ_s_Recidivism_Challenge_Full_Dataset_20240112.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recidivated =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(Recidivism_Within_3years, <span class="st">"Yes"</span>, <span class="st">"No"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"_Arrest_|_Conviction_|Program_Attendances"</span>)), to_numeric) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, factor) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Recidivism"</span>), <span class="sc">-</span>Gang_Affiliated, <span class="sc">-</span>Training_Sample, <span class="sc">-</span>Supervision_Level_First, <span class="sc">-</span> Residence_PUMA) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.logical, factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise 1</h2>
<p>We want to predict which parolees will recidivate within 3 years of release. First, let’s see how many recidivists vs non-recidivists we have in our dataset.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>First, load the data using the code show nabove. Then, examine the balance of the classes (1 = recidivated, 0 = no recidivation) coded by the <code>recidivated</code> variable. Calculate the proportion who recidivated.</p>
</div>
</div>
</section>
<section id="exercise-2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2">Exercise 2</h2>
<p>Before we make a model, let’s do some further exploratory data analysis. We’ll take a look at the Supervision Risk score (<code>Supervision_Risk_Score_First</code>). This is a composite score based on a formula considering inmates’ prior offenses, age, behavior in prison, and other variables.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make a line-plot of the proportion of parolees who recidivated across supervision risk scores, with the proportion on the y-axis and risk scores alon the x-axis.</p>
</div>
</div>
</section>
<section id="exercise-3" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3">Exercise 3</h2>
<p>Let’s begin our machine-learning workflow!</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Split the data into training (80%) and testing (20%) splits. Since we won’t use it for prediction, drop the <code>ID</code> column before making these splits. Make sure to stratify the train/test splits by our outcome to ensure a representative class balance for our predictions. Call your training and testing splits <code>train</code> and <code>test</code></p>
</div>
</div>
</section>
<section id="exercise-4" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4">Exercise 4</h2>
<p>We’ll begin with a simple model using a single predictor: The initial supervision risk assessment score assigned upon release (<code>Supervision_Risk_Score_First</code>). This will let us see how diagnostic the existing parole methodology is.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a workflow and fit a model predicting <code>recidivated</code> from <code>Supervision_Risk_Score_First</code>. You can add the formula directly to the workflow.</p>
</div>
</div>
</section>
<section id="exercise-5" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5">Exercise 5</h2>
<p>Let’s examine this model in a few ways.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 5
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>First, <code>tidy()</code> the model and examine the coefficient for <code>Supervision_Risk_Score_First</code>. How would you interpret the coefficient? Compare the odds of recidivating for a parolee with a score of 2 to a score of 9.</li>
<li>Calculate the probability of recidivating for parolees with a score of 2 versus 9:
<ul>
<li>using <code>augment()</code> or <code>predict()</code></li>
<li>manually using <code>plogis()</code></li>
</ul></li>
</ol>
</div>
</div>
</section>
<section id="exercise-6" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6">Exercise 6</h2>
<p>Consider what you should make of the accuracy score you observe in light of the balance of recidivism you calculated in Exercise 1.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 6
</div>
</div>
<div class="callout-body-container callout-body">
<p>Calculate the expected accuracy of a “classifier” that operates by guessing based on the overall probability of recidivism. How does such a “null” model compare to our model in terms of accuracy?</p>
</div>
</div>
</section>
<section id="exercise-7" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7">Exercise 7</h2>
<p>Accuracy can be misleading when there are uneven numbers of positive and negative cases or classes in our data. To better evaluate our model, we need to employ a metric other than simple accuracy. One option for evaluating classifiers in cases with unbalanced outcome classes is <strong>Balanced Accuracy</strong>.</p>
<p>Balanced accuracy is the average of the model’s true positive rate (TPR) and its true negative rate (TNR). Unlike simple accuracy, it is “balanced” because it gives equal weight to positive and negative cases.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 7
</div>
</div>
<div class="callout-body-container callout-body">
<p>Calculate the performance of the model. Since the classes are not perfectly balanced, calculate both accuracy and balanced accuracy. In addition, calculate the <code>sensitivity</code> (TPR) and <code>specificity</code> (TNR) of the model, making sure to use the <code>event_level = "second"</code> flag.</p>
<p>Briefly consider how the TPR and TNR might influence the use of such a model.</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>metric_set()</code> function can help you do this without coding things up manually.</p>
</div>
</div>
</section>
<section id="exercise-8" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8">Exercise 8</h2>
<p>Can we do better with machine learning?</p>
<p>Let’s build a model that brings to bear all of the data we have available from this challenge dataset. Unfortunately, some of the data is missing, so the first thing we will need to do is build a pre-processing recipe to handle these cases.</p>
<p>There are many missing data approaches we might take, but we’ll take a relatively simple approach here.</p>
<ul>
<li>Where factor variables are missing we will replace them with a new “unknown” factor level</li>
<li>Where numeric variables are missing we will 1) create a new binary variable to indicate the case’s variable is missing and 2) replace the <code>NA</code> with zero.</li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>Recipes</code> package includes two helpful functions for previewing the results of a recipe. <code>prep()</code> and <code>bake()</code> can help you see what your recipe steps will accomplish, without having to train and fit a model. First you <code>prep()</code> the recipe, then you <code>bake()</code> the data using the prepped recipe.</p>
<p>The schema is:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>the_recipe <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(the_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 8
</div>
</div>
<div class="callout-body-container callout-body">
<p>Build a recipe to complete the following steps. Use <code>?</code> to read the help for each of these new functions to see how they should be used.</p>
<ol type="1">
<li>Add an “unknown” level to any factor variables that are missing data (<code>step_unknown()</code>)</li>
<li>Create new columns to indicate where continuous predictors are missing data (<code>step_indicate_na()</code>)</li>
<li>Replace <code>NA</code> values for continuous predictors with zeroes</li>
<li>Remove the <code>Supervision_Risk_Score_First</code> variable (<code>step_rm()</code>) – we just want to ignore this for our machine learning model for comparison purposes.</li>
</ol>
<p>Then, use <code>prep()</code> and <code>bake()</code> to see what this does to the training data.</p>
</div>
</div>
<div class="hidden">
<p>THIS NEEDS WORK ::: {.callout-note icon=“false” collapse=“true”} ## Deeper dive</p>
<p>Why add a variable indicating the missingness?</p>
<p>If we don’t add this variable, imputing the missing values with zero will bias our models’ parameters and could reduce its predictive performance.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw-u01_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw-u01_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>:::</p>
</section>
<section id="exercise-9" class="level2">
<h2 class="anchored" data-anchor-id="exercise-9">Exercise 9</h2>
<p>If you fit a model using the recipe you have created so far, you will receive at some point a warning that you have a “rank-deficient” model. What does this mean?</p>
<p>The term comes from linear algebra, where the <strong>rank</strong> of a matrix is (informally) the number of columns that provide distinct information, i.e.&nbsp;that are not linear combinations of any of the other columns.</p>
<p>With regression and logistic regression, we can end up with a rank-deficient model whenever:</p>
<ul>
<li>any number of predictors have zero variance (i.e.&nbsp;are all the same value)</li>
<li>any predictor variables are <strong>exactly</strong> identical to some linear combination of other predictor variables</li>
</ul>
<p>The two hypothetical datasets below show rank-deficient predictors (<code>x</code>): in the first, there is zero variance and in the second, <code>x3</code> is exactly equal to two times <code>x1</code> plus <code>x2</code>.</p>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">x1</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.60</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.30</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">x1</th>
<th style="text-align: right;">x2</th>
<th style="text-align: right;">x3</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">-1.02</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">0.70</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">-2.0</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">-0.12</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">-1.22</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-1.0</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.55</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 9
</div>
</div>
<div class="callout-body-container callout-body">
<p>Expand the recipe to prevent producing a rank-deficient model, i.e.&nbsp;remove all zero variance predictors and any variables that are linear combinations of one another. I won’t tell you exactly how, so look up the help or Google to find the right functions for this purpose.</p>
<p>One set of variables that would cause issues are the <code>na_ind_...</code> variables created for the missing drug test values. The reason is structural—if a parolee is missing drug test data for any particular drug it is because they are missing this data for all drugs. Would this produce a rank-deficient model due to zero variance predictors or predictors that are linear combinations of one another?</p>
</div>
</div>
</section>
<section id="exercise-10" class="level2">
<h2 class="anchored" data-anchor-id="exercise-10">Exercise 10</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 10
</div>
</div>
<div class="callout-body-container callout-body">
<p>Fit and calculate the performance of a model using this recipe. Compare this to the model using just the traditional supervision risk score assessment in terms of accuracy, balanced accuracy, and TPR/TNR.</p>
</div>
</div>
</section>
<section id="exercise-11" class="level2">
<h2 class="anchored" data-anchor-id="exercise-11">Exercise 11</h2>
<p>Let’s dive in to interpreting the model a bit, by considering two potentially important variables that might be somewhat under a parolee or the parole system and programming control: employment and program attendance.</p>
<p>We’ll examine the relative importance of these two predictors.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 11
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>tidy()</code> the model and filter the result to display just the coefficients for these two predictors. Look at the codebook to ensure you are interpeting them correctly in terms of their original predictors. Can you tell which is more important?</li>
<li>Interpeting the relative importance of coefficients is easier with standardized predictors. Re-fit the model adding a <code>step_normalize()</code> to the recipe and then compare thes coefficients again.</li>
<li>Make two line plots to explore the proportion of recidivists across <code>Program_Attendances</code> and a binned version of <code>Percent_Days_Employed</code> (use 10 bins). Put proportion of recidivists on the y-axis and the predictor on the x-axis. Compare the plots to the relative importance you determined based on the model coefficients—do these two ways of exploring this correspond well?</li>
</ul>
</div>
</div>
</section>
<section id="exercise-12" class="level2">
<h2 class="anchored" data-anchor-id="exercise-12">Exercise 12</h2>
<p>What does it all mean?</p>
<p>Do employement and/or program attendance reduce the risk of recidivism? Or do other factors that reduce the risk of recidivism support consistency in employment and attendance (e.g.&nbsp;relationships, social support, financial safety)?</p>
<p>More generally, how do you think should parole decisions should incorporate these kinds of predictive models to support both community safety but also justice and fairness? What does this level of accuracy support? What if you imagine we could make these predictions more accurately (e.g.&nbsp;95% or 99%)?</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise 12
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reflect on the questions above and write 1-2 paragraphs discussing your thoughts.</p>
</div>
</div>
</section>
<section id="wrapping-up" class="level1">
<h1>Wrapping up</h1>
<p>When you are finished, knit your Quarto document to a PDF file.</p>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>MAKE SURE YOU LOOK OVER THIS FILE CAREFULLY BEFORE SUBMITTING</strong></p>
</div>
</div>
<p>When you are sure it looks good, submit it on Canvas in the appropriate assignment page.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>